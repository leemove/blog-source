<html>
    <!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	

	<title>ajax入门 | 小木屋</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">	
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/caomei.css">
	<link rel="stylesheet" href="/css/style.css">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>
    <body>
        <div class="root">
            <div class='topnavs container fixed-690'>
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/archives">Archives</a>
                </li>
                
            </ul>
        </div>
    </nav>
</div>
                <section class="container mainbody fixed-690">
                    <div class="article">
    <div class="article-title">
        <h1>
            ajax入门 
        </h1>

        
        <div class="article-title-views">
            <span id="busuanzi_container_page_pv">
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
            </span>
        </div>
        
    </div>
    <div class="article-content markdown">
        <h1 id="ajax入门"><a href="#ajax入门" class="headerlink" title="ajax入门"></a>ajax入门</h1><p>AJAX即“Asynchronous JavaScript and XML”（异步的JavaScript与XML技术），指的是一套综合了多项技术的浏览器端网页开发技术。还会介绍Jquery封装的ajax和跨域问题。<br><a id="more"></a></p>
<h2 id="何为异步"><a href="#何为异步" class="headerlink" title="何为异步"></a>何为异步</h2><p>在网页加载的过程中，浏览器需要不断的从服务器通过http协议获取资源，来完成加载。主要方式有同步方式，和异步方式。在同步方式中，浏览器必须和服务器保持同步，只有相互间收到反馈时才会进行下一步，而异步则是不需要等待，直接进行下一步。</p>
<p>在传统的网页中，当提交表单的时候需要刷新整个页面，而新页面大部分页面和原页面相同。而通过异步技术可以只改变网页部分的内容，不需要刷新整个网页，大大减少了服务器的负担，但也伴随着浏览器无法后退的缺点。</p>
<h2 id="如何通过JS发送异步请求"><a href="#如何通过JS发送异步请求" class="headerlink" title="如何通过JS发送异步请求"></a>如何通过JS发送异步请求</h2><p>AJAX不需要浏览器插件的支持，对服务器来说也只是一个普通的请求，只需要浏览器提供XMLHttpRequest对象。在老版本IE中存在兼容性问题，这里就不讨论了。</p>
<ol>
<li>新建一个AJAX对象<br><code>var xhr=new XMLHttpRequest();</code>虽然对象名称包含XML，但实际上是可以传输其他数据的，比如JSON。</li>
<li><p>打开连接<br><code>xhr.open(&quot;GET&quot;,&quot;1.php?username=leemove&amp;password=what&quot;);</code></p>
<p>  open函数包含了两个参数，第一个参数是HTTP协议的传输类型，主要使用的有POST，GET。第二个参数是请求的url如果是GET方法需要在地址后面加上?后面写传送的数据用&amp;隔开。</p>
<h3 id="tips-GET-POST的区别"><a href="#tips-GET-POST的区别" class="headerlink" title="tips: GET POST的区别"></a>tips: GET POST的区别</h3><ul>
<li>GET发送的数据要写在URL中，部分情况下可能会显示到浏览器的地址框中，GET没有请求体，不太安全。POST的数据会放在请求体中，相对安全。</li>
<li>因为GET的数据在地址栏中，所有会有大小的限制，当传送大量的数据时，要使用POST。</li>
<li>POST在AJAX中必须设置q请求头<code>Content-Type:application/****</code></li>
<li>GET因为没有请求体，性能会高一些。</li>
</ul>
</li>
<li>发送数据<br><code>xhr.send(null);</code>因为GET没有请求体，所以发送的数据就是null，如果是POST可以发送内容。</li>
<li>接收数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//注册事件当状态改变时触发</div><div class="line"> xhr.onreadystatechange=function () &#123;</div><div class="line">     //判断当前的传输是否完成</div><div class="line">     if(this.readyState==4&amp;&amp;this.status==200)&#123;</div><div class="line">         //接收数据</div><div class="line">         var data=this.responseText;</div><div class="line">     &#125;</div><div class="line"> &#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>onreadystatechange事件将会在状态改变的时候被触发。<br>readyState参数分别对应了五个状态</p>
<pre><code>0：尚未初始化。未调用open()之前

1：启动。调用open()之后，但是未调用send();

2：发送。调用send()但是尚未得到响应。

3：正在接收数据。刚接收到响应数据开始到接收完成之前。

4： 完成。数据接收完成
</code></pre><p>status指HTTP中的状态码，常见的状态码有</p>
<pre><code>200：OK

304： 数据未修改，可以调用缓存，根据最后修改事件判断。

404：没有请求的资源

500：服务器内部错误

405：请求的方式不支持

302：请求的方式不支持

403：没有访问的权限
</code></pre><p>responseText也可以换成responseXML只是接受的数据格式不同。</p>
<h2 id="jquery封装的AJAX方法。"><a href="#jquery封装的AJAX方法。" class="headerlink" title="jquery封装的AJAX方法。"></a>jquery封装的AJAX方法。</h2><p>ajax也为我们封装了ajax方法，可以通过全局变量$来直接调用。<br>方法需要一个对象作为参数，对象可以有以下的属性：</p>
<ul>
<li>type 传输的类型，可以是GET—</li>
<li>data 要传输的数据 可以是字符串，但最好使用JSON</li>
<li>dataType 数据的类型，平时可以不设置，但跨域则必须使用jsonp，下一节将会讲解跨域</li>
<li>success 成功时会调用的回调函数，并且会把接收到的数据作为参数传入这个函数</li>
<li>error 错误时调用的回调函数</li>
<li>beforeSend 在发送数据之前调用的函数。</li>
<li>还有很多其他的不太常用的 可以通过Jquery的手册来查看<h3 id="调用急速数据的天气接口案例"><a href="#调用急速数据的天气接口案例" class="headerlink" title="调用急速数据的天气接口案例"></a>调用急速数据的天气接口案例</h3>只是简单的一个小例子，并不需要完全理解其他内容。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">        $.ajax(&#123;</div><div class="line">            type: <span class="string">'get'</span>,</div><div class="line">            url: <span class="string">"http://v.juhe.cn/weather/index"</span>,</div><div class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">daa</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(daa);</div><div class="line">                <span class="keyword">var</span> html = template(<span class="string">"templateId"</span>,daa);</div><div class="line">                <span class="built_in">console</span>.log(html);</div><div class="line">                $(<span class="string">'tbody'</span>).append(html);</div><div class="line">            &#125;,</div><div class="line">            data: &#123;</div><div class="line"><span class="comment">//                城市名                </span></div><div class="line">                cityname: str,</div><div class="line">                <span class="comment">//*****注意这里要输入你自己的key</span></div><div class="line">                key: <span class="string">"我是马赛克，输入你自己的KEY"</span></div><div class="line">            &#125;,</div><div class="line">            dataType: <span class="string">"jsonp"</span></div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><h3 id="什么是跨域请求"><a href="#什么是跨域请求" class="headerlink" title="什么是跨域请求"></a>什么是跨域请求</h3><p>理解跨域必须先理解同源，同源策略是浏览器的一个安全策略，浏览器只会支持同源的请求，所谓的同源也就是指必须有相同的域名，端口,以及协议。</p>
<p>如果 请求不是同源的，那么将会进行跨域，而浏览器为了安全考虑会阻止这个请求，但实际生产中，我们有时候必须进行跨域。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">例如http://www.example.com/</div><div class="line">http://api.example.com/detail.html  不同源 域名不同  </div><div class="line">https//www.example.com/detail.html   不同源 协议不同  </div><div class="line">http://www.example.com:8080/detail.html    不同源    端口不同  </div><div class="line">http://api.example.com:8080/detail.html    不同源    域名、端口不同  </div><div class="line">https://api.example.com/detail.html    不同源    协议、域名不同  </div><div class="line">https://www.example.com:8080/detail.html    不同源    端口、协议不同  </div><div class="line">http://www.example.com/detail/index.html    同源    只是目录不同</div></pre></td></tr></table></figure></p>
<h3 id="如何阻止浏览器的拦截跨域行为？？"><a href="#如何阻止浏览器的拦截跨域行为？？" class="headerlink" title="如何阻止浏览器的拦截跨域行为？？"></a>如何阻止浏览器的拦截跨域行为？？</h3><p>常见的方法有两种，一种是jsonp，一种是CORS</p>
<p>jsonp就是利用SRC属性可以跨域的特点。新建一个script标签，并将src设置成请求的url，所以只能用GET请求。然后将script标签加入到页面中，当解析到这个标签的时候就会执行内部的代码。所以可以传入一个回调函数callback，对应自己已经编写的一个函数名，然后将数据当做参数传入。返回的数据格式会是’callback(‘+json+’)’;<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button"</span>&gt;</span>请求数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript">    <span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">        <span class="keyword">var</span> button=<span class="built_in">document</span>.getElementById(<span class="string">"ibutton"</span>);</span></div><div class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="comment">//处理data</span></span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="javascript">        button.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></div><div class="line"><span class="javascript">            <span class="keyword">var</span> script=<span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span></div><div class="line"><span class="javascript">            script=<span class="string">"http://www.sasd.com/json/?callbak=callback"</span>; </span></div><div class="line"><span class="javascript">            <span class="built_in">document</span>.body.insertBefore(script,<span class="built_in">document</span>.body.firstChild);<span class="comment">//加载脚本</span></span></div><div class="line"><span class="undefined">            </span></div><div class="line"><span class="undefined">        &#125;</span></div><div class="line"><span class="undefined">        </span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>另外一种方法是CORS是利用协议。当浏览器发送请求时，会在请求中标注自己的域名，<code>origin:客户端所在的域</code>服务器如果在x响应头中添加<code>Access-Control-Allow-Origin:请求的客户端地址</code>然后再发给客户端，客户端的浏览器就会允许跨域。</p>
 
    </div>
    <div class="article-foot">
        <div id="disqus_thread"></div>
    </div>
</div>


                </section>
                <footer class="container fixed-690 footer">
    <div>
        <span>Power by <a href="https://hexo.io">Hexo</a></span>
    </div>
    <div>
        <span>Theme <a href="https://github.com/zhengxiaowai/hexo-theme-lessless">lessless</a></span>
    </div>
    
<div>
    <span id="hexiangyutest_container_site_pv">
    PV: <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
    UV: <span id="busuanzi_value_site_uv"></span>
    </span>
</div>

</footer>
        </div>
        
<script src="/js/jquery-3.2.1.slim.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


    
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://leemove.info/2016/05/01/ajax入门/';
        this.page.identifier = '2016/05/01/ajax入门/';
        this.page.title = 'ajax入门';
    };
    var d = document, s = d.createElement('script');
    s.src = '//hexiangyu.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
</script>


    </body>
</html>